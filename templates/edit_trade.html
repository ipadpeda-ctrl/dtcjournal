<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Modifica Trade</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config = { darkMode: 'class' }</script>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-100 p-8 h-screen flex justify-center items-center transition-colors">

    <div class="bg-white dark:bg-gray-800 p-8 rounded shadow-lg w-full max-w-4xl overflow-y-auto max-h-screen border-t-4 border-indigo-500">
        <h2 class="text-2xl font-bold mb-6 text-gray-800 dark:text-white">Modifica Operazione</h2>
        
        <form method="POST" action="" class="grid grid-cols-1 md:grid-cols-2 gap-6">
            
            <div>
                <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Coppia</label>
                <select name="pair" class="border dark:border-gray-600 p-2 rounded w-full bg-white dark:bg-gray-700 dark:text-white border-blue-500">
                    <option value="{{ trade.pair }}" selected class="bg-gray-300 dark:bg-gray-600 font-bold">{{ trade.pair }} (Attuale)</option>
                    {% if custom_pairs %}
                    <optgroup label="I Miei Strumenti">
                        {% for cp in custom_pairs %}
                        <option value="{{ cp }}">{{ cp }}</option>
                        {% endfor %}
                    </optgroup>
                    {% endif %}
                    <optgroup label="Forex Majors"><option>EURUSD</option><option>GBPUSD</option><option>USDJPY</option><option>USDCAD</option><option>AUDUSD</option></optgroup>
                    <optgroup label="Forex Crosses"><option>EURGBP</option><option>GBPJPY</option><option>EURJPY</option><option>AUDJPY</option><option>CADJPY</option></optgroup>
                    <optgroup label="Indices"><option>US30</option><option>NAS100</option><option>SPX500</option><option>DAX40</option><option>UK100</option></optgroup>
                    <optgroup label="Crypto"><option>BTCUSD</option><option>ETHUSD</option><option>SOLUSD</option></optgroup>
                </select>
            </div>

            <div><label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Data</label><input type="date" name="date" value="{{ trade.date.strftime('%Y-%m-%d') }}" class="border dark:border-gray-600 p-2 rounded w-full bg-white dark:bg-gray-700 dark:text-white"></div>
            <div><label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Orario</label><input type="time" name="time" value="{{ trade.time }}" class="border dark:border-gray-600 p-2 rounded w-full bg-white dark:bg-gray-700 dark:text-white"></div>
            <div><label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Direzione</label><select name="direction" class="border dark:border-gray-600 p-2 rounded w-full bg-white dark:bg-gray-700 dark:text-white"><option value="Long" {% if trade.direction == 'Long' %}selected{% endif %}>Long</option><option value="Short" {% if trade.direction == 'Short' %}selected{% endif %}>Short</option></select></div>
            <div><label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Esito</label><select name="outcome" class="border dark:border-gray-600 p-2 rounded w-full bg-white dark:bg-gray-700 dark:text-white"><option value="Target" {% if trade.outcome == 'Target' %}selected{% endif %}>Target</option><option value="Stop Loss" {% if trade.outcome == 'Stop Loss' %}selected{% endif %}>Stop Loss</option><option value="Breakeven" {% if trade.outcome == 'Breakeven' %}selected{% endif %}>Breakeven</option><option value="Non Fillato" {% if trade.outcome == 'Non Fillato' %}selected{% endif %}>Non Fillato</option><option value="Setup" {% if trade.outcome == 'Setup' %}selected{% endif %}>Setup</option></select></div>
            <div><label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Emozioni</label><select name="emotions" class="border dark:border-gray-600 p-2 rounded w-full bg-white dark:bg-gray-700 dark:text-white"><option value="{{ trade.emotions }}" selected>{{ trade.emotions }}</option><option value="ansia">Ansia</option><option value="stress">Stress</option><option value="paura">Paura</option><option value="fretta">Fretta</option><option value="tranquillo">Tranquillo</option><option value="sicuro">Sicuro</option><option value="calmo">Calmo</option></select></div>
            
            <div class="col-span-1 md:col-span-2 grid grid-cols-4 gap-4 bg-gray-50 dark:bg-gray-700 p-2 rounded">
                <div><label class="block text-xs font-bold mb-1">Rischio %</label><input type="number" step="0.01" name="risk_percent" value="{{ trade.risk_percent }}" class="border p-1 rounded w-full"></div>
                <div><label class="block text-xs font-bold mb-1">Risultato %</label><input type="number" step="0.01" name="result_percent" value="{{ trade.result_percent }}" class="border p-1 rounded w-full font-bold"></div>
                <div><label class="block text-xs font-bold mb-1">Pips SL</label><input type="number" step="0.1" name="pips_sl" value="{{ trade.pips_sl }}" class="border p-1 rounded w-full text-red-500"></div>
                <div><label class="block text-xs font-bold mb-1">Pips TP</label><input type="number" step="0.1" name="pips_tp" value="{{ trade.pips_tp }}" class="border p-1 rounded w-full text-green-500"></div>
            </div>
            
            <div class="col-span-1 border-t dark:border-gray-700 pt-4">
                <p class="font-bold text-sm text-gray-600 dark:text-gray-300 mb-2 uppercase">Barrier (Entry)</p>
                <div class="flex flex-wrap gap-2">{% for tf in ['m1','m3','m5','m15','m30'] %}<label class="inline-flex items-center bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded cursor-pointer"><input type="checkbox" name="timeframe_barrier" value="{{ tf }}" class="form-checkbox text-blue-600" {% if tf in curr_barriers %}checked{% endif %}><span class="ml-2 text-sm dark:text-gray-200">{{ tf }}</span></label>{% endfor %}</div>
            </div>

            <div class="col-span-1 border-t dark:border-gray-700 pt-4">
                <p class="font-bold text-sm text-gray-600 dark:text-gray-300 mb-2 uppercase">Alignment (Trend)</p>
                <div class="flex flex-wrap gap-2">{% for tf in ['h1','h4','D1','W','M'] %}<label class="inline-flex items-center bg-blue-50 dark:bg-gray-800 px-2 py-1 rounded cursor-pointer"><input type="checkbox" name="timeframe_align" value="{{ tf }}" class="form-checkbox text-purple-600" {% if tf in curr_aligns %}checked{% endif %}><span class="ml-2 text-sm dark:text-gray-200">{{ tf }}</span></label>{% endfor %}</div>
            </div>

            <div class="col-span-1 border dark:border-gray-700 rounded p-2 bg-green-50 dark:bg-gray-900"><p class="font-bold text-sm text-green-700 dark:text-green-400 mb-2">Pro</p>{% for pro in user_pros_list %}<label class="flex items-center mb-1"><input type="checkbox" name="pros" value="{{ pro }}" class="form-checkbox text-green-600" {% if pro in curr_pros %}checked{% endif %}><span class="ml-2 text-xs dark:text-gray-300">{{ pro }}</span></label>{% endfor %}</div>
            <div class="col-span-1 border dark:border-gray-700 rounded p-2 bg-red-50 dark:bg-gray-900"><p class="font-bold text-sm text-red-700 dark:text-red-400 mb-2">Contro</p>{% for con in user_cons_list %}<label class="flex items-center mb-1"><input type="checkbox" name="cons" value="{{ con }}" class="form-checkbox text-red-600" {% if con in curr_cons %}checked{% endif %}><span class="ml-2 text-xs dark:text-gray-300">{{ con }}</span></label>{% endfor %}</div>

            <div class="col-span-1"><label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Link 1</label><input type="text" name="link1" value="{{ val_link1 }}" class="border dark:border-gray-600 p-2 rounded w-full bg-white dark:bg-gray-700 dark:text-white"></div>
            <div class="col-span-1"><label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Link 2</label><input type="text" name="link2" value="{{ val_link2 }}" class="border dark:border-gray-600 p-2 rounded w-full bg-white dark:bg-gray-700 dark:text-white"></div>
            <textarea name="notes" class="border dark:border-gray-600 p-2 rounded w-full h-24 col-span-1 md:col-span-2 bg-white dark:bg-gray-700 dark:text-white">{{ trade.notes }}</textarea>

            <div class="col-span-1 md:col-span-2 flex justify-between mt-4"><a href="/dashboard" class="bg-gray-500 dark:bg-gray-700 text-white font-bold py-2 px-4 rounded">Annulla</a><button type="submit" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">Salva Modifiche</button></div>
        </form>
    </div>
</body>
</html>